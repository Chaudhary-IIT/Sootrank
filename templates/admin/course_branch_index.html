<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Course–Branch Categories - Sootrank Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background-color: #f9fafb; }
    .table-actions button, .table-actions a { margin-right: 5px; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow">
    <div class="container">
      <a class="navbar-brand" href="{% url 'custom_admin_home' %}">Sootrank Admin</a>
      <a href="{%url 'bulk_upload_course_branch'%}" class="btn btn-outline-light ms-auto me-2">Bulk Add Assignments</a>
      <a href="{% url 'course_branch_index' %}" class="btn btn-light">Refresh</a>
    </div>
  </nav>

  <div class="container my-5">
    <h2 class="mb-3 text-primary">Course–Branch Categories</h2>

    <!-- Search and filters -->
    <div class="row g-2 mb-3">
      <div class="col-12 col-md-6">
        <div class="input-group">
          <span class="input-group-text"><i class="fa fa-search"></i></span>
          <input type="text" id="courseSearch" class="form-control" placeholder="Search by code, name, credits, slot…">
        </div>
      </div>
      <div class="col-12 col-md-3">
        <input type="number" id="creditsFilter" class="form-control" min="0" placeholder="Filter by credits">
      </div>
      <div class="col-12 col-md-3">
        <input type="text" id="slotFilter" class="form-control" placeholder="Filter by slot (e.g., A, B, FS)">
      </div>
    </div>

    <div class="table-responsive shadow-sm bg-white rounded p-3">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-primary">
          <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Credits</th>
            <th>Slot</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="coursesBody">
          {% for c in courses %}
          <tr class="course-row">
            <td class="c-code">{{ c.code }}</td>
            <td class="c-name">{{ c.name }}</td>
            <td class="c-credits">{{ c.credits }}</td>
            <td class="c-slot">{{ c.slot }}</td>
            <td class="table-actions">
              <a href="{% url 'manage_course_branches' c.id %}" class="btn btn-sm btn-secondary" title="Assign DC/DE/IC/HSS to branches">
                <i class="fa fa-sitemap"></i> Assign categories
              </a>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="5" class="text-center">No courses found.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <script>
    (function () {
      const $q = document.getElementById('courseSearch');
      const $cr = document.getElementById('creditsFilter');
      const $slot = document.getElementById('slotFilter');
      const rows = Array.from(document.querySelectorAll('#coursesBody .course-row'));

      function norm(s){ return (s || '').toString().toLowerCase().trim(); }

      function matches(row, q, cr, sl) {
        const code = row.querySelector('.c-code')?.textContent || '';
        const name = row.querySelector('.c-name')?.textContent || '';
        const credits = row.querySelector('.c-credits')?.textContent || '';
        const slot = row.querySelector('.c-slot')?.textContent || '';

        const hay = (code + ' ' + name + ' ' + credits + ' ' + slot).toLowerCase();

        const qHit = !q || hay.includes(q);
        const crHit = !cr || parseInt(credits, 10) === parseInt(cr, 10);
        const slHit = !sl || norm(slot).includes(norm(sl));
        return qHit && crHit && slHit;
      }

      function apply() {
        const q = norm($q.value);
        const cr = ($cr.value || '').toString().trim();
        const sl = ($slot.value || '').toString().trim();
        rows.forEach(r => r.style.display = matches(r, q, cr, sl) ? '' : 'none');
      }

      $q.addEventListener('input', apply);
      $cr.addEventListener('input', apply);
      $slot.addEventListener('input', apply);
    })();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</body>
</html>
