<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Export Database - Sootrank Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <style>
        body {
            background-color: #f8f9fa;
            font-size: 14px;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
        }

        .export-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3rem;
            position: relative;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #dee2e6;
            z-index: 0;
        }

        .step {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .step.active {
            background: #0d6efd;
            border-color: #0d6efd;
            color: white;
        }

        .step.completed {
            background: #198754;
            border-color: #198754;
            color: white;
        }

        .step-label {
            text-align: center;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: #6c757d;
        }

        .step-label.active {
            color: #0d6efd;
            font-weight: 600;
        }

        .data-type-card {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: white;
        }

        .data-type-card:hover {
            border-color: #0d6efd;
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.15);
            transform: translateY(-2px);
        }

        .data-type-card.selected {
            border-color: #0d6efd;
            background: rgba(13, 110, 253, 0.05);
        }

        .data-type-card i {
            font-size: 2.5rem;
            color: #0d6efd;
            margin-bottom: 1rem;
        }

        .data-type-card h5 {
            margin: 0;
            color: #212529;
        }

        .data-type-card p {
            margin: 0.5rem 0 0 0;
            color: #6c757d;
            font-size: 0.875rem;
        }

        .filter-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .format-selector {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .format-option {
            flex: 1;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .format-option:hover {
            border-color: #0d6efd;
            background: rgba(13, 110, 253, 0.05);
        }

        .format-option.selected {
            border-color: #0d6efd;
            background: rgba(13, 110, 253, 0.1);
        }

        .format-option i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .export-summary {
            background: #e7f1ff;
            border-left: 4px solid #0d6efd;
            padding: 1rem;
            border-radius: 4px;
            margin-top: 1.5rem;
        }

        .btn-export-final {
            padding: 0.75rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'database_management' %}">
                <i class="fas fa-arrow-left me-2"></i>Back to Database
            </a>
            <span class="navbar-text text-white">
                <i class="fas fa-file-export me-2"></i>Export Data
            </span>
        </div>
    </nav>

    <div class="container py-4">
        <div class="export-card">
            <h2 class="text-primary fw-bold mb-4">
                <i class="fas fa-download me-2"></i>Export Database
            </h2>
            <p class="text-muted mb-4">Select data type, apply filters, and export in your preferred format</p>

            <!-- Step Indicator -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-center align-items-center gap-5">
                        <div class="text-center">
                            <div class="step active" id="step1">1</div>
                            <div class="step-label active" id="label1">Select Data</div>
                        </div>
                        <div style="width: 100px; height: 2px; background: #dee2e6;"></div>
                        <div class="text-center">
                            <div class="step" id="step2">2</div>
                            <div class="step-label" id="label2">Apply Filters</div>
                        </div>
                        <div style="width: 100px; height: 2px; background: #dee2e6;"></div>
                        <div class="text-center">
                            <div class="step" id="step3">3</div>
                            <div class="step-label" id="label3">Choose Format</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 1: Select Data Type -->
            <div id="stepContent1">
                <h4 class="mb-3">Step 1: Select Data Type</h4>
                <div class="row g-3">
                    <div class="col-md-3">
                        <div class="data-type-card" onclick="selectDataType('students')">
                            <i class="fas fa-user-graduate"></i>
                            <h5>Students</h5>
                            <p>{{ students_count }} records</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="data-type-card" onclick="selectDataType('faculty')">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <h5>Faculty</h5>
                            <p>{{ faculty_count }} records</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="data-type-card" onclick="selectDataType('courses')">
                            <i class="fas fa-book-open"></i>
                            <h5>Courses</h5>
                            <p>{{ courses_count }} records</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="data-type-card" onclick="selectDataType('enrollments')">
                            <i class="fas fa-clipboard-list"></i>
                            <h5>Enrollments</h5>
                            <p>{{ enrollments_count }} records</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="data-type-card" onclick="selectDataType('branches')">
                            <i class="fas fa-code-branch"></i>
                            <h5>Branches</h5>
                            <p>{{ branches_count }} records</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="data-type-card" onclick="selectDataType('departments')">
                            <i class="fas fa-building"></i>
                            <h5>Departments</h5>
                            <p>{{ departments_count }} records</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="data-type-card" onclick="selectDataType('categories')">
                            <i class="fas fa-tags"></i>
                            <h5>Categories</h5>
                            <p>{{ categories_count }} records</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="data-type-card" onclick="selectDataType('requirements')">
                            <i class="fas fa-tasks"></i>
                            <h5>Requirements</h5>
                            <p>{{ requirements_count }} records</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Apply Filters -->
            <div id="stepContent2" class="hidden">
                <h4 class="mb-3">Step 2: Apply Filters</h4>
                
                <!-- Students Filters -->
                <div id="filtersStudents" class="filter-section hidden">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Admission Year (Multiple)</label>
                            <select class="form-select" id="studentYear" multiple size="5">
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                                <option value="2020">2020</option>
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Branch (Multiple)</label>
                            <select class="form-select" id="studentBranch" multiple size="5">
                                {% for branch in branches %}
                                <option value="{{ branch.name }}">{{ branch.name }}</option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Semester (Multiple)</label>
                            <select class="form-select" id="studentSemester" multiple size="5">
                                <option value="1">Semester 1</option>
                                <option value="2">Semester 2</option>
                                <option value="3">Semester 3</option>
                                <option value="4">Semester 4</option>
                                <option value="5">Semester 5</option>
                                <option value="6">Semester 6</option>
                                <option value="7">Semester 7</option>
                                <option value="8">Semester 8</option>
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Department (Multiple)</label>
                            <select class="form-select" id="studentDepartment" multiple size="5">
                                {% for dept in departments %}
                                <option value="{{ dept.code }}">{{ dept.code }}</option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                        </div>
                    </div>
                </div>

                <!-- Faculty Filters -->
                <div id="filtersFaculty" class="filter-section hidden">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Department (Multiple)</label>
                            <select class="form-select" id="facultyDepartment" multiple size="5">
                                {% for dept in departments %}
                                <option value="{{ dept.code }}">{{ dept.code }} - {{ dept.name }}</option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Minimum Courses Teaching</label>
                            <select class="form-select" id="facultyMinCourses">
                                <option value="">Any</option>
                                <option value="1">At least 1 course</option>
                                <option value="2">At least 2 courses</option>
                                <option value="3">At least 3 courses</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Courses Filters -->
                <div id="filtersCourses" class="filter-section hidden">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Slot (Multiple)</label>
                            <select class="form-select" id="courseSlot" multiple size="5">
                                <option value="A">Slot A</option>
                                <option value="B">Slot B</option>
                                <option value="C">Slot C</option>
                                <option value="D">Slot D</option>
                                <option value="E">Slot E</option>
                                <option value="F">Slot F</option>
                                <option value="G">Slot G</option>
                                <option value="H">Slot H</option>
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Credits (Multiple)</label>
                            <select class="form-select" id="courseCredits" multiple size="4">
                                <option value="1">1 Credit</option>
                                <option value="2">2 Credits</option>
                                <option value="3">3 Credits</option>
                                <option value="4">4 Credits</option>
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Status (Multiple)</label>
                            <select class="form-select" id="courseStatus" multiple size="2">
                                <option value="Yes">Active</option>
                                <option value="No">Inactive</option>
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                        </div>
                    </div>
                </div>

                <!-- Enrollments Filters -->
                <div id="filtersEnrollments" class="filter-section hidden">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label fw-bold">Semester (Multiple)</label>
                            <select class="form-select" id="enrollmentSemester" multiple size="5">
                                <option value="1">Semester 1</option>
                                <option value="2">Semester 2</option>
                                <option value="3">Semester 3</option>
                                <option value="4">Semester 4</option>
                                <option value="5">Semester 5</option>
                                <option value="6">Semester 6</option>
                                <option value="7">Semester 7</option>
                                <option value="8">Semester 8</option>
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd</small>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold">Status (Multiple)</label>
                            <select class="form-select" id="enrollmentStatus" multiple size="4">
                                <option value="PND">Pending</option>
                                <option value="ENR">Enrolled</option>
                                <option value="CMP">Completed</option>
                                <option value="DRP">Dropped</option>
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd</small>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold">Outcome (Multiple)</label>
                            <select class="form-select" id="enrollmentOutcome" multiple size="3">
                                <option value="PAS">Pass</option>
                                <option value="FAI">Fail</option>
                                <option value="UNK">Unknown</option>
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd</small>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold">Grade (Multiple)</label>
                            <select class="form-select" id="enrollmentGrade" multiple size="5">
                                <option value="A">A</option>
                                <option value="A-">A-</option>
                                <option value="B">B</option>
                                <option value="B-">B-</option>
                                <option value="C">C</option>
                                <option value="C-">C-</option>
                                <option value="D">D</option>
                                <option value="F">F</option>
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd</small>
                        </div>
                    </div>
                </div>

                <!-- Simple filters for other data types -->
                <div id="filtersBranches" class="filter-section hidden">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>All branch records will be exported
                    </div>
                </div>

                <div id="filtersDepartments" class="filter-section hidden">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>All department records will be exported
                    </div>
                </div>

                <div id="filtersCategories" class="filter-section hidden">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>All category records will be exported
                    </div>
                </div>

                <div id="filtersRequirements" class="filter-section hidden">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Branch (Multiple)</label>
                            <select class="form-select" id="requirementBranch" multiple size="5">
                                {% for branch in branches %}
                                <option value="{{ branch.name }}">{{ branch.name }}</option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Category (Multiple)</label>
                            <select class="form-select" id="requirementCategory" multiple size="5">
                                <option value="DC">Disciplinary Core (DC)</option>
                                <option value="DE">Disciplinary Elective (DE)</option>
                                <option value="IC">Institute Core (IC)</option>
                                <option value="HSS">HSS</option>
                                <option value="FE">Free Elective (FE)</option>
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <button class="btn btn-secondary" onclick="goToStep(1)">
                        <i class="fas fa-arrow-left me-2"></i>Back
                    </button>
                    <button class="btn btn-primary" onclick="goToStep(3)">
                        Next <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Choose Format & Export -->
            <div id="stepContent3" class="hidden">
                <h4 class="mb-3">Step 3: Choose Export Format</h4>
                
                <div class="format-selector">
                    <div class="format-option" id="formatExcel" onclick="selectFormat('excel')">
                        <i class="fas fa-file-excel text-success"></i>
                        <h5>Excel (.xlsx)</h5>
                        <p>Spreadsheet format with formatting</p>
                    </div>
                    <div class="format-option" id="formatCsv" onclick="selectFormat('csv')">
                        <i class="fas fa-file-csv text-info"></i>
                        <h5>CSV</h5>
                        <p>Comma-separated values</p>
                    </div>
                    <div class="format-option" id="formatPdf" onclick="selectFormat('pdf')">
                        <i class="fas fa-file-pdf text-danger"></i>
                        <h5>PDF</h5>
                        <p>Portable document format</p>
                    </div>
                </div>

                <div class="export-summary">
                    <h5 class="mb-3"><i class="fas fa-info-circle me-2"></i>Export Summary</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-2"><strong>Data Type:</strong> <span id="summaryDataType">-</span></p>
                            <p class="mb-2"><strong>Format:</strong> <span id="summaryFormat">-</span></p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>Filters Applied:</strong> <span id="summaryFilters">None</span></p>
                            <p class="mb-2"><strong>Estimated Records:</strong> <span id="summaryRecords">-</span></p>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <button class="btn btn-secondary" onclick="goToStep(2)">
                        <i class="fas fa-arrow-left me-2"></i>Back
                    </button>
                    <button class="btn btn-success btn-export-final" onclick="exportData()">
                        <i class="fas fa-download me-2"></i>Export Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentStep = 1;
        let selectedDataType = '';
        let selectedFormat = '';

        function goToStep(step) {
            if (step === 2 && !selectedDataType) {
                alert('Please select a data type first');
                return;
            }
            if (step === 3 && !selectedDataType) {
                alert('Please select a data type first');
                return;
            }

            // Hide all step contents
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`stepContent${i}`).classList.add('hidden');
                document.getElementById(`step${i}`).classList.remove('active', 'completed');
                document.getElementById(`label${i}`).classList.remove('active');
            }

            // Show current step
            document.getElementById(`stepContent${step}`).classList.remove('hidden');
            document.getElementById(`step${step}`).classList.add('active');
            document.getElementById(`label${step}`).classList.add('active');

            // Mark previous steps as completed
            for (let i = 1; i < step; i++) {
                document.getElementById(`step${i}`).classList.add('completed');
            }

            currentStep = step;

            if (step === 3) {
                updateSummary();
            }
        }

        function selectDataType(type) {
            // Remove previous selection
            document.querySelectorAll('.data-type-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Add selection to clicked card
            event.currentTarget.classList.add('selected');
            selectedDataType = type;

            // Show relevant filters
            document.querySelectorAll('[id^="filters"]').forEach(filter => {
                filter.classList.add('hidden');
            });
            document.getElementById(`filters${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.remove('hidden');

            // Auto advance to step 2
            setTimeout(() => goToStep(2), 300);
        }

        function selectFormat(format) {
            // Remove previous selection
            document.querySelectorAll('.format-option').forEach(option => {
                option.classList.remove('selected');
            });

            // Add selection
            document.getElementById(`format${format.charAt(0).toUpperCase() + format.slice(1)}`).classList.add('selected');
            selectedFormat = format;

            updateSummary();
        }

        function updateSummary() {
            document.getElementById('summaryDataType').textContent = 
                selectedDataType.charAt(0).toUpperCase() + selectedDataType.slice(1);
            
            document.getElementById('summaryFormat').textContent = 
                selectedFormat ? selectedFormat.toUpperCase() : 'Not selected';

            // Get applied filters
            let filters = getAppliedFilters();
            document.getElementById('summaryFilters').textContent = 
                filters.length > 0 ? filters.join(', ') : 'None';
        }

        function getAppliedFilters() {
            let filters = [];
            
            if (selectedDataType === 'students') {
                let years = getSelectedValues('studentYear');
                if (years.length) filters.push('Years: ' + years.join(', '));
                let branches = getSelectedValues('studentBranch');
                if (branches.length) filters.push('Branches: ' + branches.join(', '));
                let semesters = getSelectedValues('studentSemester');
                if (semesters.length) filters.push('Semesters: ' + semesters.join(', '));
                let depts = getSelectedValues('studentDepartment');
                if (depts.length) filters.push('Depts: ' + depts.join(', '));
            } else if (selectedDataType === 'faculty') {
                let depts = getSelectedValues('facultyDepartment');
                if (depts.length) filters.push('Depts: ' + depts.join(', '));
                if (document.getElementById('facultyMinCourses').value) 
                    filters.push('Min Courses: ' + document.getElementById('facultyMinCourses').value);
            } else if (selectedDataType === 'courses') {
                let slots = getSelectedValues('courseSlot');
                if (slots.length) filters.push('Slots: ' + slots.join(', '));
                let credits = getSelectedValues('courseCredits');
                if (credits.length) filters.push('Credits: ' + credits.join(', '));
                let status = getSelectedValues('courseStatus');
                if (status.length) filters.push('Status: ' + status.join(', '));
            } else if (selectedDataType === 'enrollments') {
                let semesters = getSelectedValues('enrollmentSemester');
                if (semesters.length) filters.push('Semesters: ' + semesters.join(', '));
                let status = getSelectedValues('enrollmentStatus');
                if (status.length) filters.push('Status: ' + status.join(', '));
                let outcomes = getSelectedValues('enrollmentOutcome');
                if (outcomes.length) filters.push('Outcomes: ' + outcomes.join(', '));
                let grades = getSelectedValues('enrollmentGrade');
                if (grades.length) filters.push('Grades: ' + grades.join(', '));
            } else if (selectedDataType === 'requirements') {
                let branches = getSelectedValues('requirementBranch');
                if (branches.length) filters.push('Branches: ' + branches.join(', '));
                let categories = getSelectedValues('requirementCategory');
                if (categories.length) filters.push('Categories: ' + categories.join(', '));
            }

            return filters;
        }

        function getSelectedValues(selectId) {
            let select = document.getElementById(selectId);
            let values = [];
            for (let option of select.selectedOptions) {
                values.push(option.value);
            }
            return values;
        }

        function exportData() {
            if (!selectedFormat) {
                alert('Please select an export format');
                return;
            }

            // Build query parameters
            let params = new URLSearchParams();
            params.append('data_type', selectedDataType);
            params.append('format', selectedFormat);

            // Add filters based on data type
            if (selectedDataType === 'students') {
                getSelectedValues('studentYear').forEach(v => params.append('year', v));
                getSelectedValues('studentBranch').forEach(v => params.append('branch', v));
                getSelectedValues('studentSemester').forEach(v => params.append('semester', v));
                getSelectedValues('studentDepartment').forEach(v => params.append('department', v));
            } else if (selectedDataType === 'faculty') {
                getSelectedValues('facultyDepartment').forEach(v => params.append('department', v));
                if (document.getElementById('facultyMinCourses').value) 
                    params.append('min_courses', document.getElementById('facultyMinCourses').value);
            } else if (selectedDataType === 'courses') {
                getSelectedValues('courseSlot').forEach(v => params.append('slot', v));
                getSelectedValues('courseCredits').forEach(v => params.append('credits', v));
                getSelectedValues('courseStatus').forEach(v => params.append('status', v));
            } else if (selectedDataType === 'enrollments') {
                getSelectedValues('enrollmentSemester').forEach(v => params.append('semester', v));
                getSelectedValues('enrollmentStatus').forEach(v => params.append('status', v));
                getSelectedValues('enrollmentOutcome').forEach(v => params.append('outcome', v));
                getSelectedValues('enrollmentGrade').forEach(v => params.append('grade', v));
            } else if (selectedDataType === 'requirements') {
                getSelectedValues('requirementBranch').forEach(v => params.append('branch', v));
                getSelectedValues('requirementCategory').forEach(v => params.append('category', v));
            }

            // Add CSRF token for POST request
            const csrftoken = getCookie('csrftoken');
            
            // Redirect to export URL
            window.location.href = `/custom-admin/database/export-filtered/?${params.toString()}`;
        }

        // Helper function to get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>
