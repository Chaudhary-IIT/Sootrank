{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}Student | Sootrank{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        rel="stylesheet" crossorigin="anonymous" referrerpolicy="no-referrer" />

  {% block extra_css %}{% endblock %}

  <style>
    :root {
      --nav-height: 72px;
    }

    body {
      padding-top: var(--nav-height);
      font-size: 15px;
      background: #f6f7fb;
    }

    /* Navbar */
    .navbar {
      /* FIX: Changed height to min-height.
         This allows the navbar to grow vertically on mobile when the menu is open,
         ensuring the 'bg-white' covers all the links. */
      min-height: var(--nav-height);
    }

    .navbar-brand span {
      color: #2469f0;
      font-weight: 700;
      letter-spacing: 0.3px;
    }

    .nav-link.active,
    .nav-link:focus,
    .nav-link:hover {
      color: #2469f0 !important;
    }

    /* Dropdown animation */
    .navbar .dropdown-menu {
      display: block;
      visibility: hidden;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 0.18s ease, transform 0.2s ease, visibility 0s linear 0.2s;
      position: absolute;
      inset: auto;
    }

    @media (min-width: 992px) {
      .navbar .dropdown:hover > .dropdown-menu {
        visibility: visible;
        opacity: 1;
        transform: translateY(0);
        transition: opacity 0.18s ease, transform 0.2s ease;
      }
    }

    .navbar .dropdown-menu.show {
      visibility: visible !important;
      opacity: 1 !important;
      transform: none !important;
      transition: none;
    }

    /* Layout spacing */
    .container-page {
      padding-top: 12px;
      padding-bottom: 24px;
    }

    .card {
      border: 1px solid #e8ecf2;
      border-radius: 12px;
      background: #fff;
    }

    .card + .card {
      margin-top: 1rem;
    }

    /* Utility */
    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      background: #dc3545;
      position: absolute;
      top: 6px;
      right: 6px;
    }

    .navbar .dropdown-menu-end {
      right: 0 !important;
      left: auto !important;
      transform-origin: top right;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg bg-white border-bottom fixed-top">
    <div class="container-fluid">

      <div class="d-none d-lg-block" style="width:140px;"></div>

      <a class="navbar-brand d-flex align-items-center mx-lg-auto" href="{% url 'students_dashboard' %}">
        <img src="{% static 'images/sootrank_logo.jpg' %}" alt="Sootrank logo" width="36" height="36" class="me-2">
        <span>Sootrank</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#studentNavbar" aria-controls="studentNavbar"
              aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="studentNavbar">
        <ul class="navbar-nav ms-auto me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link{% block nav_dashboard_active %}{% endblock %}"
               href="{% url 'students_dashboard' %}"
               aria-current="{% block nav_dashboard_current %}{% endblock %}">
              Dashboard
            </a>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle{% block nav_registration_active %}{% endblock %}"
               href="#" id="regDrop" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Registration
            </a>
            <ul class="dropdown-menu" aria-labelledby="regDrop">
              <li><a class="dropdown-item" href="{% url 'prereg_page' %}">Pre-Registration</a></li>
              <li><a class="dropdown-item" href="{% url 'check_status_page' %}">Check Status</a></li>
              <li><a class="dropdown-item" href="{% url 'registered_courses' %}">Registered Courses</a></li>
            </ul>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle{% block nav_results_active %}{% endblock %}"
               href="#" id="resultsDrop" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Results
            </a>
            <ul class="dropdown-menu" aria-labelledby="resultsDrop">
              {% if student and student.roll_no %}
                <li>
                  <a class="dropdown-item" href="{% url 'student_result_semester_list' student.roll_no %}">
                    <i class="fa-regular fa-file-lines me-2"></i> View Results
                  </a>
                </li>
              {% else %}
                <li>
                  <a class="dropdown-item" href="{% url 'students_dashboard' %}" tabindex="-1">
                    <i class="fa-regular fa-file-lines me-2"></i> View Results
                  </a>
                </li>
              {% endif %}
            </ul>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle{% block nav_quick_links_active %}{% endblock %}"
               href="#" id="quickLinksDrop" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Quick Links
            </a>
            <ul class="dropdown-menu" aria-labelledby="quickLinksDrop">
              <li><a class="dropdown-item" href="{% url 'student_attendance' %}">Attendance</a></li>
              <li><a class="dropdown-item" href="{% url 'student_fees' %}">Fee Status</a></li>
              <li><a class="dropdown-item" href="{% url 'timetable' %}">Time Table</a></li>
              <li>
                <a class="dropdown-item" href="https://academics.iitmandi.ac.in/calendar"
                   target="_blank" rel="noopener">Academic Calendar</a>
              </li>
            </ul>
          </li>
        </ul>

        <ul class="navbar-nav align-items-center gap-2 mb-2 mb-lg-0 ms-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#"
               id="profileDrop" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <img src="{% static 'images/sootrank_logo.jpg' %}" alt="Profile" width="28" height="28"
                   class="rounded-circle me-2">
              <span class="fw-semibold">{{ student.first_name }} {{ student.last_name|default_if_none:"" }}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDrop">
              <li>
                <a class="dropdown-item" href="{% url 'student_profile' %}">
                  <i class="fa-solid fa-user me-2"></i> My Profile
                </a>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <form method="post" action="{% url 'logout' %}">
                  {% csrf_token %}
                  <button class="dropdown-item text-danger">
                    <i class="fa-solid fa-right-from-bracket me-2"></i> Logout
                  </button>
                </form>
              </li>
            </ul>
          </li>
        </ul>
      </div>

    </div>
  </nav>

  <div class="container mt-3">
    {% if messages %}
      <div class="mb-3">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} mb-2" role="alert">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <div class="container container-page">
    {% block content %}{% endblock %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  {% block script %}{% endblock %}
  {% block extra_js %}{% endblock %}
</body>
</html>
